<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CARL History</title>
  <link rel="stylesheet" href="static/style-history.css" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <button class="close-sidebar">✕</button>
      <h2>CARL AI</h2>
      <ul class="sidebar-menu">
        <li><button class="nav-btn" onclick="goToPage('/')">New Chat</button></li>
        <li><button class="nav-btn" onclick="goToPage('/extensions')">Extensions</button></li>
        <li><button class="nav-btn" onclick="goToPage('/history')">History</button></li>
      </ul>

      <ul class="sidebar-settings">
        <li><button class="nav-btn">Settings</button></li>
      </ul>
    </div>

    <!-- Main History Interface -->
    <div class="main">
      <div class="chat-header">
        <button class="hamburger">☰</button>
        <header>
          <h1>Chatbot AI</h1>
          <!-- <button id="toggle-dark">Dark Mode</button> -->
        </header>
      </div>

      <div class="history-buttons">
        <button class="history-button" onclick="toggleSection('chat')">Chat History</button>
        <button class="history-button" onclick="toggleSection('extensions')">Extension's History</button>
        <button class="history-button" onclick="toggleSection('archive')">Archive</button>
      </div>

      <!-- Chat History Section -->
      <div id="chat" class="history-section">
        <ul class="history-list">
          {% for session in sessions %}
          <li>
            <div class="history-row" onclick="toggleItem(this)">
              <div>
                <div class="history-topic">{{ session.name }}</div>
                <div class="history-date">{{ session.timestamp }}</div>
              </div>
              <span class="arrow">▼</span>
            </div>
            <div class="history-details" style="display: none;">
              <p><strong>First Question:</strong> {{ session.first_message }}</p>
            </div>
          </li>
          {% endfor %}
        </ul>
      </div>

      <!-- Extensions History Section -->
      <div id="extensions" class="history-section" style="display: none;">
        <ul class="history-list">
          <li>
            <div class="history-row" onclick="toggleItem(this)">
              <div>
                <div class="history-topic">LangChain Extension Install</div>
                <div class="history-date">July 20, 2025</div>
              </div>
              <span class="arrow">▼</span>
            </div>
            <div class="history-details" style="display: none;">Walkthrough of installing LangChain as a browser
              extension and testing basic features.</div>
          </li>
        </ul>
      </div>

      <!-- Archive Section -->
      <div id="archive" class="history-section" style="display: none;">
        <ul class="history-list">
          <li>
            <div class="history-row" onclick="toggleItem(this)">
              <div>
                <div class="history-topic">Archived Chat: Data Preprocessing</div>
                <div class="history-date">June 18, 2025</div>
              </div>
              <span class="arrow">▼</span>
            </div>
            <div class="history-details" style="display: none;">Covers data cleaning, normalization, and encoding
              methods used in typical ML workflows.</div>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    // function for selecting chat-history extension history and archive.
    function toggleSection(sectionId) {
      const sections = document.querySelectorAll('.history-section');
      sections.forEach(section => section.style.display = 'none');
      document.getElementById(sectionId).style.display = 'block';
    }

    // function to open the history row.
    function toggleItem(row) {
      const details = row.nextElementSibling;
      const arrow = row.querySelector('.arrow');
      const isOpen = details.style.display === 'block';
      details.style.display = isOpen ? 'none' : 'block';
      arrow.textContent = isOpen ? '▼' : '▲';
    }
    // Sidebar function to move to other pages
    function goToPage(route) {
      window.location.href = route;
    }

    //Sidebar function to open   
    document.querySelector('.hamburger').addEventListener('click', () => {
      document.querySelector('.sidebar').classList.toggle('active');
    });
    //Sidebar function to close
    document.querySelector('.close-sidebar').addEventListener('click', () => {
      document.querySelector('.sidebar').classList.remove('active');
    });
  </script>
</body>

</html>
